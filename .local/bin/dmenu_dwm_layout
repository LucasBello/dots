#!/bin/bash

# Fetch layouts and make sure each entry is on a new line 
layout_data=$(dwm-msg --ignore-reply get_layouts | jq --unbuffered -c '.[]')

# Create an associative array layout-address pairs
declare -A layouts

# Iterate over all layouts 
for row in ${layout_data}; do
    # Fetch relevant data
    #symbol=$(echo $row | jq --unbuffered -r '.symbol')
    #address=$(echo $row | jq --unbuffered -r '.address')
    symbol=$(grep -oP '"symbol":"\K.*?(?=",)' <<< "$row")
    address=$(grep -oP '"address":\K.*?(?=})' <<< "$row")

    # Associate symbol with address
    layouts+=([$symbol]=$address)
done

# Get user choice
choice=$(printf "%s\n" "${!layouts[@]}" | dmenu -i -F)

# Exit if no choice
[ -z "$choice" ] && exit 1

address=${layouts[$choice]}

# Set dwm layout
dwm-msg run_command setlayoutsafe $address
